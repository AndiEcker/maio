#: import version main.__version__
#: import os os
#: import Label kivy.uix.label.Label
#: import Popup kivy.uix.popup.Popup


<MaioMenuBar@BoxLayout>:
    size_hint_y: None
    height: sp(90)
    Button:
        size_hint_x: None
        width: sp(369)
        on_release:
            Popup(title="Irmi's shopping list V " + version + "   (c) 2020 Andi Ecker",
            title_align='center',
            content=Label(text=
            "Touch short on list icon/name for\n"
            " to display their items.\n"
            "Touch long for to change list icon/name.\n"
            "Wipe list name for to drop the list.\n"
            "Change list name for to copy the list.\n\n"
            "Similar actions for each list item\n"
            " are available within each list.",
            halign='center'),
            size_hint_y=.6
            ).open()
        StackLayout:
            pos: self.parent.pos
            size: self.parent.size
            Image:
                source: 'img/app_icon.jpg'
                size_hint_x: None
                width: self.parent.height
            Label:
                text:
                    app.data.selected_list_name[:18 if app.landscape else 3] \
                    + ("/" + app.data.selected_list_item[:18 if app.landscape else 3] \
                    if app.data.selected_list_item else "")
                size_hint_x: None
                width: self.parent.width - self.parent.height
    Button:
        text: 'Lists'
        on_release: app.switch_to_items_view()
    ListFiltButton:
        id: listFilterDown
        text: 'B'
        state: 'down' if app.data.filter_selected else 'normal'
        canvas:
            Color:
                rgba: (0, 0, 1, .1)
            Rectangle:
                pos: self.pos
                size: self.size
    ListFiltButton:
        id: listFilterNormal
        text: 'G'
        state: 'down' if app.data.filter_unselected else 'normal'
    Button:
        text: '+'
        on_release: app.add_new_list_item()
        font_size: self.size[1]
        background_color: [.9, .9, .9, .6]
        background_normal: 'atlas://data/images/defaulttheme/slider_cursor_disabled'
        background_down: 'atlas://data/images/defaulttheme/slider_cursor'
        #icon: 'atlas://data/images/defaulttheme/audio-volume-high'
        canvas.after:
            Color:
                rgba: 1, 0, 0, .6
            Ellipse:
                pos: self.pos[0] + sp(6), self.pos[1] + sp(6)
                size: self.size[0] - sp(12), self.size[1] - sp(12)
    Button:
        text: '-'
        on_release: app.delete_list_item(app.data.selected_list_item)
        disabled: app.data.selected_list_item
        opacity: 1 if app.data.selected_list_item else 0
        font_size: self.size[1]
        background_color: [.9, .9, .9, .6]
        background_normal: 'atlas://data/images/defaulttheme/slider_cursor_disabled'
        background_down: 'atlas://data/images/defaulttheme/slider_cursor'
        canvas.after:
            Color:
                rgba: 1, .3, 0, .6
            Ellipse:
                pos: self.pos[0] + sp(6), self.pos[1] + sp(6)
                size: self.size[0] - sp(12), self.size[1] - sp(12)


<ListFiltButton@ToggleButton>:
    # exchanging down/normal state and using radio button mode results in
    # .. automatic selection of at least one button (preventing empty list)
    important: True
    minimum_width: self.height
    background_normal: 'atlas://data/images/defaulttheme/slider_cursor'
    background_down: 'atlas://data/images/defaulttheme/slider_cursor_disabled'
    canvas:
        Color: 
            rgba: app.toggled_item_ink
        Rectangle:
            pos: self.pos
            size: self.size
    on_release: app.toggle_list_filter(self.text, self.state)
    group: 'listFilt'

    
<ListName@BoxLayout>:
    size_hint_y: None
    height: app.data.font_size * 1.5
    on_text: print('ListName.on_text', self.text)
    text: editButton.text
    Button:
        id: editButton
        size_hint_x: 0.69
        text: root.text
        font_size: app.data.font_size
        padding_x: sp(9)
        halign: 'center'
        valign: 'middle'
        text_size: self.size
        canvas:
            Color:
                rgba: app.normal_item_ink
            Rectangle:
                pos: self.pos
                size: self.size
        on_release: app.data.select_list(self.text); app.list_name_edit_start(self.text)
    Button:
        id: selectButton
        size_hint_x: 0.30
        text: '-- >'
        font_size: app.data.font_size * 1.2
        padding_x: sp(9)
        halign: 'center'
        valign: 'middle'
        text_size: self.size
        canvas:
            Color:
                rgba: app.toggled_item_ink if editButton.text == app.data.selected_list_name else app.normal_item_ink
            Rectangle:
                pos: self.pos
                size: self.size
        on_release: app.data.select_list(editButton.text); app.refresh_items_list()

<ListNameEditor@Popup>:
    size_hint: 0.6, 0.3
    on_dismiss: app.list_name_edit_finished(txtInp.text)
    auto_dismiss: True
    TextInput:
        id: txtInp
        text: root.title
        focus: True
        multiline: False
        font_size: app.data.font_size
        height: self.font_size * 1.5
        halign: 'left'
        valign: 'middle'
        text_size: self.size



<ListItem@ToggleButton>:
    size_hint_y: None
    font_size: app.data.font_size
    height: self.font_size * 1.5
    padding_x: sp(9)
    halign: 'left'
    valign: 'middle'
    text_size: self.size
    shorten: True
    shorten_from: 'right'
    split_str: '..'
    canvas:
        Color: 
            rgba: app.toggled_item_ink
        Rectangle:
            pos: self.pos
            size: self.size
    on_touch_down: app.items_list_touch_down_handler(self.text, args[1])
    on_touch_up: app.items_list_touch_up_handler(self.text, args[1])
    on_state: app.toggle_list_item(self.text, self.state)

    
<ListItemEditor@Popup>:
    size_hint: 0.9, 0.3
    on_dismiss: app.list_item_edit_finished(txtInp.text)
    auto_dismiss: True
    TextInput:
        id: txtInp
        text: root.title
        focus: True
        font_size: app.data.font_size
        height: self.font_size * 1.5
        halign: 'left'
        valign: 'middle'
        text_size: self.size


<ConfirmListDeletePopup@Popup>:
    size_hint: 0.9, 0.15
    auto_dismiss: True
    title: "Confirm deletion of the list " + (root.what or "><")
    title_align: 'center'
    what: self.what
    Button:
        text: "Ok"
        on_release: app.delete_list_confirmed(root.what); root.dismiss()


<MaioRoot@FloatLayout>:
    id: maioRoot
    BoxLayout:
        orientation: 'vertical'
        MaioMenuBar:
            id: menuBar
        ScrollView:
            do_scroll_x: False
            BoxLayout:
                id: listContainer
                orientation: 'vertical'
                size_hint_y: None
    Button:
        text: '+'
        size_hint: None, None
        size: sp(60) if app.landscape else sp(90), sp(90) if app.landscape else sp(60)
        font_size: self.size[1]
        pos_hint: {'right': 1.0}
        background_color: [.9, .9, .9, .6]
        background_normal: 'atlas://data/images/defaulttheme/slider_cursor_disabled'
        background_down: 'atlas://data/images/defaulttheme/slider_cursor'
        on_release: app.add_new_list_item()
        canvas.after:
            Color:
                rgba: 1, 0, 0, .6
            Ellipse:
                pos: self.pos[0] + sp(6), self.pos[1] + sp(6)
                size: self.size[0] - sp(12), self.size[1] - sp(12)
                source: 'img/app_icon.jpg'
